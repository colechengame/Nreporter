# çµ±ä¸€ N8N æ­¸æª”æµç¨‹æ¶æ§‹è¨­è¨ˆ

## æ ¸å¿ƒç†å¿µ

> **æ‰€æœ‰å ±è¡¨ï¼Œç„¡è«–ä¾†æºï¼Œéƒ½çµ±ä¸€é€é N8N å·¥ä½œæµé€²è¡Œæª”åè§£æèˆ‡æ­¸æª”**

---

## æ–¹æ¡ˆæ¯”è¼ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æ–¹æ¡ˆ A: é›™è»Œåˆ¶                                     â”‚
â”‚                      (å„è‡ªè™•ç†ï¼Œå…±ç”¨ Registry)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   èˆŠç‰ˆ N8N â”€â”€â”€â”€â”€â”¬â”€â”€â†’ Registry API â”€â”€â†’ Google Drive                         â”‚
â”‚                 â”‚                                                           â”‚
â”‚   æ–°ç‰ˆç³»çµ± â”€â”€â”€â”€â”€â”˜                                                           â”‚
â”‚                                                                             â”‚
â”‚   å„ªé»: æ–°ç³»çµ±å¯å³æ™‚ä¸Šå‚³ï¼Œæ•ˆèƒ½è¼ƒå¥½                                           â”‚
â”‚   ç¼ºé»: å…©å¥—ä¸Šå‚³é‚è¼¯ï¼Œç¶­è­·æˆæœ¬é«˜                                             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ–¹æ¡ˆ B: çµ±ä¸€ N8N (æ¨è–¦)                                  â”‚
â”‚                    (æ‰€æœ‰å ±è¡¨éƒ½èµ° N8N)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   èˆŠç‰ˆè¨‚é–± â”€â”€â”€â”€â”€â”¬                                                           â”‚
â”‚                 â”‚                                                           â”‚
â”‚   æ–°ç‰ˆç³»çµ± â”€â”€â”€â”€â”€â”¼â”€â”€â†’ æš«å­˜å€ â”€â”€â†’ N8N å·¥ä½œæµ â”€â”€â†’ Google Drive                 â”‚
â”‚                 â”‚                                                           â”‚
â”‚   æ‰‹å‹•ä¸Šå‚³ â”€â”€â”€â”€â”€â”˜                                                           â”‚
â”‚                                                                             â”‚
â”‚   å„ªé»: å–®ä¸€æµç¨‹ï¼Œå¥½ç¶­è­·ï¼Œè¦å‰‡é›†ä¸­ç®¡ç†                                       â”‚
â”‚   ç¼ºé»: å¤šä¸€å€‹æš«å­˜æ­¥é©Ÿï¼Œæœ‰äº›è¨±å»¶é²                                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å»ºè­°ï¼šæ–¹æ¡ˆ B - çµ±ä¸€èµ° N8N

ç†ç”±ï¼š
1. **ç¶­è­·æˆæœ¬ä½**ï¼šåªéœ€ç¶­è­·ä¸€å¥—æ­¸æª”é‚è¼¯
2. **è¦å‰‡é›†ä¸­**ï¼šæª”åè§£æè¦å‰‡éƒ½åœ¨ N8Nï¼Œä¸éœ€åŒæ­¥
3. **å½ˆæ€§é«˜**ï¼šN8N çš„ visual workflow è®“éå·¥ç¨‹å¸«ä¹Ÿèƒ½èª¿æ•´è¦å‰‡
4. **å¯©è¨ˆå®Œæ•´**ï¼šæ‰€æœ‰æª”æ¡ˆéƒ½ç¶“éåŒä¸€å€‹æµç¨‹ï¼Œæ—¥èªŒå®Œæ•´

---

## çµ±ä¸€ N8N æ¶æ§‹è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              æ•´é«”æ¶æ§‹                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¾†æº 1     â”‚  â”‚  ä¾†æº 2     â”‚  â”‚  ä¾†æº 3     â”‚  â”‚  ä¾†æº 4     â”‚
â”‚  èˆŠç‰ˆè¨‚é–±   â”‚  â”‚  æ–°ç‰ˆç³»çµ±   â”‚  â”‚  æ‰‹å‹•ä¸Šå‚³   â”‚  â”‚  å¤–éƒ¨ API   â”‚
â”‚  (Email)    â”‚  â”‚  (æ’ç¨‹ç”¢ç”Ÿ) â”‚  â”‚  (ä¸­æ§å°)   â”‚  â”‚  (Webhook)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚                â”‚
       â”‚                â”‚                â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                           â”‚
                â”‚      ğŸ“ æš«å­˜å€             â”‚
                â”‚      (Staging Area)       â”‚
                â”‚                           â”‚
                â”‚   Google Drive è³‡æ–™å¤¾     â”‚
                â”‚   æˆ– S3 / æœ¬åœ°è³‡æ–™å¤¾      â”‚
                â”‚                           â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Trigger: æ–°æª”æ¡ˆ
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                         N8N å ±è¡¨æ­¸æª”å·¥ä½œæµ                                   â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ Trigger â”‚â”€â”€â”€â–¶â”‚ è§£ææª”å     â”‚â”€â”€â”€â–¶â”‚ æŸ¥è©¢        â”‚â”€â”€â”€â–¶â”‚ æ±ºå®šç›®æ¨™è³‡æ–™å¤¾ â”‚ â”‚
â”‚   â”‚         â”‚    â”‚              â”‚    â”‚ Registry    â”‚    â”‚                â”‚ â”‚
â”‚   â”‚ â€¢ æ–°æª”æ¡ˆâ”‚    â”‚ â€¢ æ­£å‰‡æ¯”å°   â”‚    â”‚             â”‚    â”‚ â€¢ é–€å¸‚+å ±è¡¨    â”‚ â”‚
â”‚   â”‚ â€¢ æ’ç¨‹  â”‚    â”‚ â€¢ æå–é–€å¸‚   â”‚    â”‚ â€¢ é©—è­‰é–€å¸‚  â”‚    â”‚ â€¢ å»ºç«‹å­è³‡æ–™å¤¾ â”‚ â”‚
â”‚   â”‚ â€¢ Webhook   â”‚ â€¢ æå–å ±è¡¨   â”‚    â”‚ â€¢ é©—è­‰å ±è¡¨  â”‚    â”‚   (å¦‚ä¸å­˜åœ¨)   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ æå–æ—¥æœŸ   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚          â”‚
â”‚                                                                 â”‚          â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                  â”‚                                                         â”‚
â”‚                  â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ ä¸Šå‚³è‡³          â”‚â”€â”€â”€â–¶â”‚ è¨˜éŒ„ä¸Šå‚³       â”‚â”€â”€â”€â–¶â”‚ é€šçŸ¥ (å¯é¸)     â”‚        â”‚
â”‚   â”‚ Google Drive    â”‚    â”‚                â”‚    â”‚                 â”‚        â”‚
â”‚   â”‚                 â”‚    â”‚ â€¢ ä¾†æºç³»çµ±     â”‚    â”‚ â€¢ Slack         â”‚        â”‚
â”‚   â”‚ â€¢ ç›®æ¨™è³‡æ–™å¤¾    â”‚    â”‚ â€¢ åŸå§‹æª”å     â”‚    â”‚ â€¢ Email         â”‚        â”‚
â”‚   â”‚ â€¢ æ¨™æº–åŒ–æª”å    â”‚    â”‚ â€¢ ç›®æ¨™è·¯å¾‘     â”‚    â”‚ â€¢ Webhook       â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ è™•ç†æ™‚é–“     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  éŒ¯èª¤è™•ç†                                                           â”‚ â”‚
â”‚   â”‚  â€¢ è§£æå¤±æ•— â†’ ç§»è‡³ã€Œå¾…äººå·¥è™•ç†ã€è³‡æ–™å¤¾                               â”‚ â”‚
â”‚   â”‚  â€¢ ä¸Šå‚³å¤±æ•— â†’ é‡è©¦ 3 æ¬¡ â†’ é€šçŸ¥ç®¡ç†å“¡                                â”‚ â”‚
â”‚   â”‚  â€¢ é‡è¤‡æª”æ¡ˆ â†’ è¦†è“‹èˆŠç‰ˆ æˆ– é‡æ–°å‘½å                                  â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                           â”‚
                â”‚      ğŸ“ Google Drive      â”‚
                â”‚      (ç›®æ¨™å ±è¡¨è³‡æ–™å¤¾)      â”‚
                â”‚                           â”‚
                â”‚   /é–€å¸‚å ±è¡¨/æ¿æ©‹å…‰æ¾¤é†«ç¾/  â”‚
                â”‚   /é–€å¸‚å ±è¡¨/å¿ å­å…‰æ¾¤/      â”‚
                â”‚   ...                     â”‚
                â”‚                           â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å„ä¾†æºçš„æ¥å…¥æ–¹å¼

### 1. èˆŠç‰ˆè¨‚é–±å¼å ±è¡¨ (Email)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¾æœ‰æµç¨‹ (ä¸éœ€ä¿®æ”¹)                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Email æ”¶ä»¶ â”€â”€â†’ N8N Email Trigger â”€â”€â†’ ä¸‹è¼‰é™„ä»¶ â”€â”€â†’ æš«å­˜å€     â”‚
â”‚                                                                 â”‚
â”‚   æª”åç¯„ä¾‹: BZ_MED_R001_20240115.xlsx                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ–°ç‰ˆç³»çµ± (API è§¸ç™¼)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°ç‰ˆç³»çµ±ç”¢ç”Ÿå ±è¡¨å¾Œï¼Œæ”¾å…¥æš«å­˜å€æˆ–ç›´æ¥è§¸ç™¼ N8N                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   æ–¹å¼ A: æª”æ¡ˆå¼                                                â”‚
â”‚   æ–°ç³»çµ± â”€â”€â†’ ç”¢ç”Ÿå ±è¡¨ â”€â”€â†’ ä¸Šå‚³è‡³æš«å­˜å€ â”€â”€â†’ N8N è‡ªå‹•åµæ¸¬        â”‚
â”‚                                                                 â”‚
â”‚   æ–¹å¼ B: API å¼ (æ¨è–¦)                                         â”‚
â”‚   æ–°ç³»çµ± â”€â”€â†’ ç”¢ç”Ÿå ±è¡¨ â”€â”€â†’ å‘¼å« N8N Webhook â”€â”€â†’ N8N è™•ç†        â”‚
â”‚                                                                 â”‚
â”‚   Webhook å‘¼å«ç¯„ä¾‹:                                             â”‚
â”‚   POST https://n8n.company.com/webhook/report-upload            â”‚
â”‚   {                                                             â”‚
â”‚     "filename": "BZ_MED_R001_20240115.xlsx",                   â”‚
â”‚     "source": "NEW_SYSTEM",                                     â”‚
â”‚     "fileUrl": "https://storage.../temp/report.xlsx",          â”‚
â”‚     "metadata": {                                               â”‚
â”‚       "storeCode": "BZ_MED",                                   â”‚
â”‚       "reportCode": "R001",                                     â”‚
â”‚       "generatedAt": "2024-01-15T10:30:00Z"                    â”‚
â”‚     }                                                           â”‚
â”‚   }                                                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æ‰‹å‹•ä¸Šå‚³ (ä¸­æ§å°)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸­æ§å°æä¾›ä¸Šå‚³ä»‹é¢ï¼Œçµ±ä¸€é€é€² N8N                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚   â”‚  ğŸ“¤ æ‰‹å‹•ä¸Šå‚³å ±è¡¨                    â”‚                       â”‚
â”‚   â”‚                                     â”‚                       â”‚
â”‚   â”‚  é¸æ“‡é–€å¸‚: [â–¼ æ¿æ©‹å…‰æ¾¤é†«ç¾    ]     â”‚                       â”‚
â”‚   â”‚  é¸æ“‡å ±è¡¨: [â–¼ R001 è­·ç†éƒ¨æ¶ˆè€—  ]    â”‚                       â”‚
â”‚   â”‚  å ±è¡¨æ—¥æœŸ: [â–¼ 2024-01-15      ]     â”‚                       â”‚
â”‚   â”‚                                     â”‚                       â”‚
â”‚   â”‚  [ğŸ“ é¸æ“‡æª”æ¡ˆ] report.xlsx          â”‚                       â”‚
â”‚   â”‚                                     â”‚                       â”‚
â”‚   â”‚  é è¦½æª”å: BZ_MED_R001_20240115.xlsxâ”‚                       â”‚
â”‚   â”‚                                     â”‚                       â”‚
â”‚   â”‚        [ä¸Šå‚³ä¸¦æ­¸æª”]                 â”‚                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                 â”‚
â”‚   æµç¨‹:                                                         â”‚
â”‚   1. å‰ç«¯ä¾é¸æ“‡çµ„åˆæˆæ¨™æº–æª”å                                   â”‚
â”‚   2. ä¸Šå‚³æª”æ¡ˆè‡³æš«å­˜å€                                           â”‚
â”‚   3. è§¸ç™¼ N8N Webhook                                           â”‚
â”‚   4. N8N è§£æä¸¦æ­¸æª”                                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## N8N å·¥ä½œæµè©³ç´°è¨­è¨ˆ

### æ ¸å¿ƒå·¥ä½œæµ: Report Filing Workflow

```yaml
# N8N Workflow Export (ç°¡åŒ–ç‰ˆ)

name: "å ±è¡¨æ­¸æª”å·¥ä½œæµ"
nodes:

  # ====== Trigger å±¤ ======

  - name: "Webhook Trigger"
    type: "n8n-nodes-base.webhook"
    parameters:
      path: "report-upload"
      httpMethod: "POST"

  - name: "File Watcher Trigger"
    type: "n8n-nodes-base.localFileTrigger"
    parameters:
      path: "/staging/reports/"
      events: ["add"]

  # ====== è§£æå±¤ ======

  - name: "è§£ææª”å"
    type: "n8n-nodes-base.code"
    parameters:
      jsCode: |
        // æª”åè§£æè¦å‰‡ (é›†ä¸­ç®¡ç†åœ¨é€™è£¡ï¼)
        const filename = $input.item.json.filename;

        // è¦å‰‡ 1: æ¨™æº–æ ¼å¼ - é–€å¸‚ä»£ç¢¼_å ±è¡¨ä»£ç¢¼_æ—¥æœŸ
        const pattern1 = /^([A-Z_]+)_([A-Z]\d+[a-z]?)_(\d{6,8})\.xlsx$/i;

        // è¦å‰‡ 2: èˆŠæ ¼å¼ - å ±è¡¨åç¨±_é–€å¸‚åç¨±_æ—¥æœŸ
        const pattern2 = /^(.+å ±è¡¨)_(.+?)_(\d{6})\.xlsx$/i;

        // è¦å‰‡ 3: ç°¡æ˜“æ ¼å¼ - é–€å¸‚ä»£ç¢¼_å ±è¡¨ä»£ç¢¼
        const pattern3 = /^([A-Z_]+)_([A-Z]\d+[a-z]?)\.xlsx$/i;

        let match, parseResult;

        if (match = filename.match(pattern1)) {
          parseResult = {
            storeCode: match[1],
            reportCode: match[2],
            date: match[3],
            pattern: 'standard'
          };
        } else if (match = filename.match(pattern2)) {
          parseResult = {
            reportName: match[1],
            storeName: match[2],
            date: match[3],
            pattern: 'legacy',
            needsLookup: true  // éœ€è¦æŸ¥è¡¨è½‰æ›
          };
        } else if (match = filename.match(pattern3)) {
          parseResult = {
            storeCode: match[1],
            reportCode: match[2],
            date: new Date().toISOString().slice(0,10).replace(/-/g,''),
            pattern: 'simple'
          };
        } else {
          parseResult = {
            error: true,
            message: 'ç„¡æ³•è§£ææª”å',
            pattern: 'unknown'
          };
        }

        return { ...parseResult, originalFilename: filename };

  # ====== æŸ¥è©¢å±¤ ======

  - name: "æŸ¥è©¢é–€å¸‚è³‡è¨Š"
    type: "n8n-nodes-base.httpRequest"
    parameters:
      url: "{{ $env.API_URL }}/api/stores"
      qs:
        code: "={{ $json.storeCode }}"
    # æˆ–ç›´æ¥ä½¿ç”¨ Google Sheets ä½œç‚º Registry

  - name: "æŸ¥è©¢å ±è¡¨è³‡è¨Š"
    type: "n8n-nodes-base.httpRequest"
    parameters:
      url: "{{ $env.API_URL }}/api/reports"
      qs:
        code: "={{ $json.reportCode }}"

  # ====== æ±ºç­–å±¤ ======

  - name: "æ±ºå®šç›®æ¨™è³‡æ–™å¤¾"
    type: "n8n-nodes-base.code"
    parameters:
      jsCode: |
        const store = $input.item.json.store;
        const report = $input.item.json.report;

        // è³‡æ–™å¤¾çµæ§‹: /é–€å¸‚å ±è¡¨/{é–€å¸‚åç¨±}/{å ±è¡¨åˆ†é¡}/
        const categoryMap = {
          'OPERATION': 'ç‡Ÿé‹',
          'HR': 'äººè³‡',
          'FINANCE': 'è²¡å‹™',
          'MARKETING': 'è¡ŒéŠ·',
          'MEMBER': 'æœƒå“¡',
          'SYSTEM': 'ç³»çµ±'
        };

        const targetPath = `/é–€å¸‚å ±è¡¨/${store.name}/${categoryMap[report.category] || 'å…¶ä»–'}`;

        // æ¨™æº–åŒ–æª”å
        const standardFilename = `${report.code}_${report.name}_${$json.date}.xlsx`;

        return {
          targetPath,
          targetFolderId: store.driveFolders?.[report.category] || store.rootFolderId,
          standardFilename,
          ...($input.item.json)
        };

  # ====== åŸ·è¡Œå±¤ ======

  - name: "ç¢ºä¿è³‡æ–™å¤¾å­˜åœ¨"
    type: "n8n-nodes-base.googleDrive"
    parameters:
      operation: "createFolder"
      folderName: "={{ $json.targetPath.split('/').pop() }}"
      parentId: "={{ $json.parentFolderId }}"
      options:
        ignoreIfExists: true

  - name: "ä¸Šå‚³æª”æ¡ˆ"
    type: "n8n-nodes-base.googleDrive"
    parameters:
      operation: "upload"
      folderId: "={{ $json.targetFolderId }}"
      name: "={{ $json.standardFilename }}"

  # ====== è¨˜éŒ„å±¤ ======

  - name: "è¨˜éŒ„ä¸Šå‚³"
    type: "n8n-nodes-base.googleSheets"  # æˆ–ç”¨è³‡æ–™åº«
    parameters:
      operation: "append"
      sheetId: "{{ $env.LOG_SHEET_ID }}"
      range: "ä¸Šå‚³è¨˜éŒ„!A:H"
      columns:
        timestamp: "={{ $now.toISO() }}"
        source: "={{ $json.source || 'N8N_AUTO' }}"
        originalFilename: "={{ $json.originalFilename }}"
        standardFilename: "={{ $json.standardFilename }}"
        storeName: "={{ $json.store.name }}"
        reportName: "={{ $json.report.name }}"
        targetPath: "={{ $json.targetPath }}"
        status: "SUCCESS"

  # ====== éŒ¯èª¤è™•ç† ======

  - name: "éŒ¯èª¤è™•ç†"
    type: "n8n-nodes-base.googleDrive"
    parameters:
      operation: "move"
      fileId: "={{ $json.fileId }}"
      folderId: "{{ $env.ERROR_FOLDER_ID }}"  # å¾…è™•ç†è³‡æ–™å¤¾

  - name: "é€šçŸ¥ç®¡ç†å“¡"
    type: "n8n-nodes-base.slack"
    parameters:
      channel: "#report-alerts"
      text: "âš ï¸ å ±è¡¨æ­¸æª”å¤±æ•—\næª”å: {{ $json.originalFilename }}\néŒ¯èª¤: {{ $json.error }}"
```

---

## Registry çš„ç°¡åŒ–ç‰ˆæœ¬

### ä½¿ç”¨ Google Sheets ä½œç‚º Registry (æœ€ç°¡å–®)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ æ¥µç°¡æ–¹æ¡ˆ: ç”¨ Google Sheets ç®¡ç†æ‰€æœ‰è¨­å®š                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š Registry Sheet (Google Sheets)
â”œâ”€â”€ Sheet 1: é–€å¸‚æ¸…å–®
â”‚   â”‚ code     â”‚ name         â”‚ type â”‚ roleEmail              â”‚ rootFolderId â”‚
â”‚   â”‚ BZ_MED   â”‚ æ¿æ©‹å…‰æ¾¤é†«ç¾ â”‚ MED  â”‚ bz_med.mgr@company.com â”‚ 1abc...      â”‚
â”‚   â”‚ ZX_GZ    â”‚ å¿ å­å…‰æ¾¤     â”‚ MED  â”‚ zx_gz.mgr@company.com  â”‚ 2def...      â”‚
â”‚
â”œâ”€â”€ Sheet 2: å ±è¡¨æ¸…å–®
â”‚   â”‚ code  â”‚ name           â”‚ category  â”‚
â”‚   â”‚ R001  â”‚ è­·ç†éƒ¨æ¶ˆè€—å ±è¡¨ â”‚ OPERATION â”‚
â”‚   â”‚ R003a â”‚ æ–°é€²äººå“¡åå–®   â”‚ HR        â”‚
â”‚
â”œâ”€â”€ Sheet 3: è³‡æ–™å¤¾æ˜ å°„
â”‚   â”‚ storeCode â”‚ category  â”‚ folderId  â”‚
â”‚   â”‚ BZ_MED    â”‚ OPERATION â”‚ 3ghi...   â”‚
â”‚   â”‚ BZ_MED    â”‚ HR        â”‚ 4jkl...   â”‚
â”‚
â””â”€â”€ Sheet 4: ä¸Šå‚³è¨˜éŒ„ (Audit Log)
    â”‚ timestamp â”‚ source â”‚ filename â”‚ store â”‚ report â”‚ status â”‚
```

### N8N è®€å– Google Sheets Registry

```javascript
// N8N Code ç¯€é»: å¾ Sheets æŸ¥è©¢é–€å¸‚
const storeCode = $json.storeCode;

// é€é Google Sheets ç¯€é»æŸ¥è©¢
const storeRow = $items("æŸ¥è©¢é–€å¸‚Sheet").find(
  row => row.json.code === storeCode
);

if (!storeRow) {
  throw new Error(`æ‰¾ä¸åˆ°é–€å¸‚: ${storeCode}`);
}

return {
  store: {
    code: storeRow.json.code,
    name: storeRow.json.name,
    roleEmail: storeRow.json.roleEmail,
    rootFolderId: storeRow.json.rootFolderId
  }
};
```

---

## æ–°ç‰ˆç³»çµ±çš„æ¥å…¥ä»£ç¢¼

### å¾Œç«¯ Service (å‘¼å« N8N Webhook)

```typescript
// backend/src/services/report.service.ts

export class ReportService {
  private n8nWebhookUrl = process.env.N8N_REPORT_WEBHOOK_URL;

  /**
   * æ–°ç³»çµ±ç”¢ç”Ÿå ±è¡¨å¾Œï¼Œçµ±ä¸€é€é N8N æ­¸æª”
   */
  async uploadReport(params: {
    storeCode: string;
    reportCode: string;
    fileBuffer: Buffer;
    reportDate: string;
  }): Promise<UploadResult> {

    // 1. å…ˆä¸Šå‚³æª”æ¡ˆåˆ°æš«å­˜å€ (æˆ–ç›´æ¥ base64)
    const tempUrl = await this.uploadToStaging(params.fileBuffer);

    // 2. çµ„åˆæ¨™æº–æª”å
    const filename = `${params.storeCode}_${params.reportCode}_${params.reportDate}.xlsx`;

    // 3. è§¸ç™¼ N8N Webhook
    const response = await fetch(this.n8nWebhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        filename,
        source: 'NEW_SYSTEM',
        fileUrl: tempUrl,
        metadata: {
          storeCode: params.storeCode,
          reportCode: params.reportCode,
          reportDate: params.reportDate,
          generatedAt: new Date().toISOString()
        }
      })
    });

    const result = await response.json();

    return {
      success: result.success,
      driveFileId: result.driveFileId,
      drivePath: result.drivePath
    };
  }

  private async uploadToStaging(buffer: Buffer): Promise<string> {
    // ä¸Šå‚³åˆ° GCS / S3 / æœ¬åœ°æš«å­˜
    // å›å‚³å¯å­˜å–çš„ URL
  }
}
```

---

## å®Œæ•´æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å®Œæ•´å ±è¡¨æ­¸æª”æµç¨‹                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  [èˆŠç‰ˆè¨‚é–±]          [æ–°ç‰ˆç³»çµ±]          [æ‰‹å‹•ä¸Šå‚³]
       â”‚                   â”‚                   â”‚
       â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ N8N     â”‚        â”‚ Backend â”‚        â”‚ ä¸­æ§å°      â”‚
  â”‚ Email   â”‚        â”‚ API     â”‚        â”‚ Upload UI   â”‚
  â”‚ Trigger â”‚        â”‚         â”‚        â”‚             â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â”‚                   â”‚  POST /webhook    â”‚
       â”‚                   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚
       â”‚                   â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                 â”‚
                  â”‚  N8N Webhook    â”‚
                  â”‚  Trigger        â”‚
                  â”‚                 â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                â”‚                â”‚
          â–¼                â–¼                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ è§£ææª”å   â”‚   â”‚ æŸ¥è©¢       â”‚   â”‚ æŸ¥è©¢       â”‚
   â”‚            â”‚â”€â”€â–¶â”‚ é–€å¸‚ Sheet â”‚â”€â”€â–¶â”‚ å ±è¡¨ Sheet â”‚
   â”‚ æ­£å‰‡æ¯”å°   â”‚   â”‚            â”‚   â”‚            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ çµ„åˆç›®æ¨™è·¯å¾‘    â”‚
                  â”‚ æ¨™æº–åŒ–æª”å      â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Google Drive    â”‚
                  â”‚ Upload          â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                 â”‚
          â–¼                                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æˆåŠŸ       â”‚                    â”‚ å¤±æ•—       â”‚
   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚ â€¢ è¨˜éŒ„æ—¥èªŒ â”‚                    â”‚ â€¢ ç§»è‡³å¾…è™•ç†â”‚
   â”‚ â€¢ å›å‚³æˆåŠŸ â”‚                    â”‚ â€¢ é€šçŸ¥ç®¡ç†å“¡â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å»ºè­°çš„ç›®éŒ„çµæ§‹

```
Nreporter/
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ services/
â”‚           â””â”€â”€ report.service.ts    # å‘¼å« N8N Webhook
â”‚
â”œâ”€â”€ n8n/
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â””â”€â”€ report-filing.json       # ä¸»è¦æ­¸æª”å·¥ä½œæµ
â”‚   â””â”€â”€ credentials/
â”‚       â””â”€â”€ google-drive.json
â”‚
â”œâ”€â”€ registry/  (æˆ–ç›´æ¥ç”¨ Google Sheets)
â”‚   â”œâ”€â”€ stores.json                  # é–€å¸‚æ¸…å–®
â”‚   â”œâ”€â”€ reports.json                 # å ±è¡¨æ¸…å–®
â”‚   â””â”€â”€ folder-mappings.json         # è³‡æ–™å¤¾æ˜ å°„
â”‚
â””â”€â”€ docs/
    â””â”€â”€ UNIFIED_N8N_ARCHITECTURE.md  # æœ¬æ–‡ä»¶
```

---

## å„ªç¼ºé»ç¸½çµ

### âœ… å„ªé»

| é¢å‘ | èªªæ˜ |
|------|------|
| **ç¶­è­·ç°¡å–®** | åªæœ‰ä¸€å¥—æ­¸æª”é‚è¼¯ï¼Œåœ¨ N8N ä¸­è¦–è¦ºåŒ–ç®¡ç† |
| **è¦å‰‡é›†ä¸­** | æª”åè§£æè¦å‰‡éƒ½åœ¨ N8N Code ç¯€é»ä¸­ |
| **æ˜“æ–¼æ“´å±•** | æ–°ä¾†æºåªéœ€è§¸ç™¼åŒä¸€å€‹ Webhook |
| **éå·¥ç¨‹å¸«å‹å¥½** | N8N çš„ GUI è®“ IT äººå“¡ä¹Ÿèƒ½èª¿æ•´ |
| **å®Œæ•´æ—¥èªŒ** | æ‰€æœ‰æª”æ¡ˆéƒ½ç¶“éåŒä¸€å€‹æµç¨‹ï¼Œè¿½è¹¤å®Œæ•´ |
| **ä½é–‹ç™¼æˆæœ¬** | å¾Œç«¯åªéœ€å¯« Webhook å‘¼å« |

### âš ï¸ æ³¨æ„äº‹é …

| é¢å‘ | èªªæ˜ | è§£æ±ºæ–¹æ¡ˆ |
|------|------|----------|
| **å»¶é²** | å¤šä¸€å€‹æš«å­˜æ­¥é©Ÿ | å°å ±è¡¨ç³»çµ±ä¾†èªªå¯æ¥å— (åˆ†é˜ç´š) |
| **N8N ä¾è³´** | N8N æ˜¯å–®é» | è¨­å®š N8N HA æˆ–å®¹éŒ¯æ©Ÿåˆ¶ |
| **å¤§æª”æ¡ˆ** | Webhook æœ‰å¤§å°é™åˆ¶ | ç”¨ fileUrl æ–¹å¼ï¼Œä¸ç›´æ¥å‚³æª”æ¡ˆå…§å®¹ |

---

## çµè«–

**æ¨è–¦ä½¿ç”¨çµ±ä¸€ N8N æ–¹æ¡ˆ**ï¼Œç†ç”±ï¼š

1. å ±è¡¨æ­¸æª”å°å³æ™‚æ€§è¦æ±‚ä¸é«˜ï¼Œåˆ†é˜ç´šå»¶é²å¯æ¥å—
2. ç¶­è­·æˆæœ¬å¤§å¹…é™ä½ï¼Œè¦å‰‡ä¿®æ”¹ä¸éœ€æ”¹ä»£ç¢¼
3. å®Œæ•´çš„ audit trail
4. æœªä¾†æ–°å¢ä¾†æºæ™‚ï¼Œåªéœ€è§¸ç™¼åŒä¸€å€‹ Webhook

åªéœ€ç¢ºä¿ï¼š
- N8N çš„ Webhook æœ‰é©ç•¶çš„èªè­‰
- æš«å­˜å€æœ‰è‡ªå‹•æ¸…ç†æ©Ÿåˆ¶
- éŒ¯èª¤è™•ç†æµç¨‹å®Œå–„
