# N-Report 權限中控台 - 系統規則說明

## 一、系統架構概述

N-Report 權限中控台是一個統一存取控制系統（Unified Access Control），用於管理門市人員的報表存取權限。

---

## 二、資料模型

### 2.1 門市 (Store)

| 欄位 | 說明 | 範例 |
| ---- | ---- | ---- |
| `code` | 門市代碼（唯一識別碼，不可修改） | `BZ_MED`, `ZX_SPA` |
| `name` | 門市名稱 | 板橋光澤醫美、忠孝岩盤浴 |
| `roleEmail` | 角色 Email（Role Email） | `dr.shine.manager1@gmail.com` |
| `primaryManager` | 主要店經理 | `{ name: '吳佳蓉 Tina', status: 'active' }` |
| `authorizedUsers` | 其他授權人員清單 | `[{ name, role, scopes }]` |

### 2.2 群組 (Group)

| 欄位 | 說明 | 範例 |
| ---- | ---- | ---- |
| `name` | 群組名稱 | Tina 多店管理組、嫚珈 多店管理組 |
| `stores` | 包含的門市名稱清單 | `['板橋光澤醫美', '忠孝光澤']` |
| `managers` | 群組管理者清單 | `[{ name: '吳佳蓉 Tina', scopes: [...] }]` |

---

## 三、報表清單 (28 種)

| 代碼 | 報表名稱 |
| ---- | ---- |
| R001 | 護理部消耗報表 |
| R003a | 新進人員名單&離職報表 |
| R003b | 新人關懷名單 |
| R004 | 員購報表 |
| R005 | 好友專案報表 |
| R006 | 進銷貨明細 |
| R007 | 好友介紹人報表 |
| R008 | 電銷報表 |
| R009 | 手術追蹤報表 |
| R010 | 設定影片名單 |
| R011 | 離職人數統計表 |
| R012 | 電銷獎金經營客表 |
| R013 | 電銷獎金總表 |
| R014 | 每月時數表 |
| R015 | 報修系統報表 |
| R016 | 諮詢師消耗額統計 |
| R017 | 諮詢師積分 |
| R018 | 營養師獎金報表 |
| R019 | 報修系統積分表 |
| R020 | 生美、醫美品項明細表 |
| R021 | 非護理部手術消耗報表 |
| R022 | 會員資料異動報表 |
| R023 | 高耗材異常領用清單 |
| R024 | 近半年銷售或消耗低於50報表 |
| R025 | 醫師考勤明細 |
| R026 | 中醫諮詢師積分 |
| R027 | 各體系分院代碼 |
| R028 | 中醫藥膳消耗統計 |

---

## 四、門市清單

### 4.1 醫美部門 (Medical Aesthetic)

| 店別 | 代碼 | 店長/窗口 | Role Email |
| ---- | ---- | ---- | ---- |
| 板橋光澤醫美 | BZ_MED | 吳佳蓉 Tina | dr.shine.manager1@gmail.com |
| 忠孝光澤 | ZX_GZ | 吳弈澐 | dr.shine.tp.manager@gmail.com |
| 三峽光澤診所 | SX_GZ | 小潔 | dr.shine.ss207@gmail.com |
| 板橋光澤健保 | BZ_JB | 謝嫚珈 | dr.shine.bm.Manager@gmail.com |
| 三重光澤 | SC_GZ | 林欣誼 | dr.shine.scsc.manager@gmail.com |
| 新莊光澤診所 | XZ_GZ | 謝嫚珈 | dr.shine.bm.Manager@gmail.com |
| 林口彤顏診所 | LK_TY | 劉玉婷 | dr.shine.lk.manager@gmail.com |
| 八德健保診所 | BD_JB | 徐惠芳 Nana | dr.shine.tu.bmmanager@gmail.com |
| 新竹光澤診所 | HC_GZ | 徐惠芳 Nana | dr.shine.tu.bmmanager@gmail.com |
| 古亭光澤 | GT_GZ | 劉瑀樂 Gigi | dr.shine.gt.manager@gmail.com |
| 南西光澤診所 | NX_GZ | 劉婉如 Cathy | dr.shine.tp2.manager@gmail.com |
| 三民光澤診所 | SM_GZ | 吳怡萩 Juby | dr.shine.nj.manager@gmail.com |
| 大直光澤診所 | DZ_GZ | 吳怡萩 Juby | dr.shine.nj.manager@gmail.com |
| 羅東光澤 | LD_GZ | 黃毓芩 Winnie | dr.shine.ld.Manager@gmail.com |
| 高雄醫美 | KS_MED | 許又婕 | dr.shine.ksm01@gmail.com |
| 中壢彤顏醫美 | ZL_TY | 黃翔琳 Kelly | dr.shine.jl.manager@gmail.com |
| 中壢彤顏健保 | ZL_TY_JB | 吳淑玲 | dr.shine.jl.bmmanager@gmail.com |
| 桃園醫美 | TY_MED | 黃曉盈 | dr.shine.tu.manager1@gmail.com |
| 台中光澤診所 | TC_GZ | 黃依華 Makiyo | dr.shine.ss312@gmail.com |
| 永和彤顏診所 | YH_TY | 王千豪 Sogo | dr.shine.kk72@gmail.com |

### 4.2 岩盤浴部門 (Stone Spa)

| 店別 | 代碼 | 主要負責人 | 次要負責人 | Role Email |
| ---- | ---- | ---- | ---- | ---- |
| 板橋岩盤浴 | BZ_SPA | 吳佳蓉 Tina | 洪綵霙 | dr.shine.manager1@gmail.com |
| 忠孝岩盤浴 | ZX_SPA | 吳弈澐 | 林函誼 | dr.shine.tp.manager@gmail.com |
| 台中岩盤浴 | TC_SPA | 林郁潔 | - | dr.shine.ss320@gmail.com |
| 羅東岩盤浴 | LD_SPA | 黃毓芩 Winnie | 黃湘婷 | dr.shine.ld.Manager@gmail.com |
| 中壢岩盤浴 | ZL_SPA | 邱唐如 | - | natashaqiu1113@gmail.com |
| 桃園岩盤浴 | TY_SPA | 王千豪 Sogo | - | dr.shine.kk72@gmail.com |

---

## 五、多店管理群組

### 5.1 Tina 多店管理組

- **管理者**: 吳佳蓉 Tina
- **管轄門市**: 板橋光澤醫美、忠孝光澤、三峽光澤診所、板橋岩盤浴、忠孝岩盤浴

### 5.2 嫚珈 多店管理組

- **管理者**: 謝嫚珈
- **管轄門市**: 板橋光澤健保、三重光澤、新莊光澤診所、林口彤顏診所

### 5.3 Nana 多店管理組

- **管理者**: 徐惠芳 Nana
- **管轄門市**: 八德健保診所、新竹光澤診所

### 5.4 全域副本收件人

- **收件人**: 協理、William、Arthur
- **說明**: 所有報表皆需同時發送給以上三位

---

## 六、權限規則

### 6.1 門市層級權限

#### 主要店經理 (Primary Manager)

- 每間門市**只能有一位**主要店經理
- 主要店經理自動繼承該門市的 Role Email
- 可透過「權限移轉」更換店經理
- 若設為「暫時懸缺」，則該門市無主要負責人

#### 細部授權人員 (Granular Users)

- 每間門市可以有**多位**細部授權人員
- 每位人員需指定可存取的報表範圍（R001-R028）
- 細部權限獨立於主要店經理權限

### 6.2 群組層級權限

#### 群組管理者

- 群組可包含多間門市
- 群組管理者可存取**所有群組內門市**的指定報表
- 適用於區督導、區經理等跨店管理角色
- 每個群組可有多位管理者，各自設定不同的報表權限

---

## 七、發送規則

### 7.1 醫美部門發送規則

```
該店店長 + 指定多店管理者 (若有) + 全域副本收件人
```

### 7.2 岩盤浴部門發送規則

```
主要負責人 + 次要負責人 (若有) + 全域副本收件人
```

---

## 八、操作規則

### 8.1 門市管理操作

| 操作 | 說明 | 影響範圍 |
| ---- | ---- | ---- |
| 新展店設定 | 建立新門市，自動生成 Role Email | 新增一筆門市資料 |
| 門市設定 | 修改門市名稱、Role Email | 同步更新 Google Drive 權限與 n8n 分派規則 |
| 權限移轉 | 更換主要店經理 | 新店經理繼承 Role Email |
| 加人 | 新增細部授權人員 | 該人員獲得指定報表存取權 |

### 8.2 群組管理操作

| 操作 | 說明 | 影響範圍 |
| ---- | ---- | ---- |
| 新增管理群組 | 建立新群組，選擇門市與管理者 | 管理者獲得群組內所有門市的報表權限 |
| 編輯群組 | 修改群組名稱、調整包含門市 | 影響管理者可存取的門市範圍 |
| 刪除群組 | 移除整個群組 | 所有管理者失去該群組的權限 |
| 新增管理者 | 為群組新增管理者 | 新管理者獲得群組報表權限 |
| 移除管理者 | 從群組移除管理者 | 該管理者失去群組報表權限 |

---

## 九、AI 助手指令規則

AI 助手支援自然語言指令，解析後執行以下動作：

| 動作類型 | 觸發語句範例 | 參數 |
| ---- | ---- | ---- |
| `ASSIGN_PRIMARY` | 「把板橋光澤醫美的店長換成 Tina」 | storeName, managerName |
| `ADD_GRANULAR` | 「讓 David 可以看忠孝岩盤浴的 R001 報表」 | storeName, userName, role, scopes |
| `CREATE_STORE` | 「新增一間台北醫美門市」 | name, code |
| `UPDATE_STORE_EMAIL` | 「修改板橋光澤醫美的 Email 為 xxx@gmail.com」 | storeName, newEmail |

---

## 十、權限繼承關係圖

```
┌─────────────────────────────────────────────────────────┐
│                   全域副本收件人                          │
│        協理 / William / Arthur (所有報表)               │
└─────────────────────────────────────────────────────────┘
                           │
           ┌───────────────┼───────────────┐
           ▼               ▼               ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│  Tina 管理組    │ │  嫚珈 管理組    │ │  Nana 管理組    │
│  5 間門市       │ │  4 間門市       │ │  2 間門市       │
└─────────────────┘ └─────────────────┘ └─────────────────┘
         │                   │                   │
    ┌────┴────┐         ┌────┴────┐         ┌────┴────┐
    ▼         ▼         ▼         ▼         ▼         ▼
┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐
│板橋醫美│ │忠孝光澤│ │板橋健保│ │三重光澤│ │八德健保│ │新竹光澤│
│ Tina  │ │ 吳弈澐 │ │ 嫚珈  │ │ 林欣誼 │ │ Nana  │ │ Nana  │
└───────┘ └───────┘ └───────┘ └───────┘ └───────┘ └───────┘
```

---

## 十一、安全性規則

1. **門市代碼不可修改**：建立後作為唯一識別碼，確保資料一致性
2. **刪除操作需確認**：刪除群組或移除管理者前，系統會彈出確認對話框
3. **權限變更即時同步**：所有變更會即時同步至 Google Drive 與 n8n
4. **角色分離**：主要店經理與細部授權人員權限獨立管理

---

## 十二、使用者角色定義

| 角色 | 典型職位 | 權限範圍 |
| ---- | ---- | ---- |
| 主要店經理 | 店長 | 單一門市完整權限 |
| 細部授權人員 | 儲備幹部、專員 | 單一門市部分報表 |
| 群組管理者 | 區督導、區經理 | 多門市指定報表 |
| 全域副本收件人 | 協理、高階主管 | 所有門市所有報表 |
| 系統管理員 | 營業部主管 | 全系統管理權限 |
